

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Customization (or the many OOD environment variables) &mdash; Open OnDemand 1.3.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Open OnDemand 1.3.0 documentation" href="index.html"/>
        <link rel="next" title="Enable Interactive Desktop" href="enable-desktops.html"/>
        <link rel="prev" title="Configure Grid Engine" href="installation/resource-manager/sge.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html">
          

          
            
            <img src="_static/logo.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                1.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Install</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="authentication.html">Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation/add-cluster-config.html">Add Cluster Configuration Files</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Customization (or the many OOD environment variables)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#setting-the-pun-environment-with-nginx-stage-yml">Setting the PUN Environment With <code class="docutils literal notranslate"><span class="pre">nginx_stage.yml</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#announcements-and-message-of-the-day-motd">Announcements and Message of the Day (MOTD)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#branding">Branding</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#title">Title</a></li>
<li class="toctree-l3"><a class="reference internal" href="#logos">Logos</a></li>
<li class="toctree-l3"><a class="reference internal" href="#colors">Colors</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#add-shortcuts-to-files-menu">Add shortcuts to Files menu</a></li>
<li class="toctree-l2"><a class="reference internal" href="#whitelist-directories">Whitelist directories</a></li>
<li class="toctree-l2"><a class="reference internal" href="#set-default-ssh-host">Set default ssh host</a></li>
<li class="toctree-l2"><a class="reference internal" href="#custom-job-composer-templates">Custom Job Composer Templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="#custom-error-page-for-missing-home-directory-on-launch">Custom Error Page for Missing Home Directory on Launch</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Extend</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="enable-desktops.html">Enable Interactive Desktop</a></li>
<li class="toctree-l1"><a class="reference internal" href="install-ihpc-apps.html">Install Other Interactive Apps</a></li>
<li class="toctree-l1"><a class="reference internal" href="app-development.html">App Development</a></li>
</ul>
<p class="caption"><span class="caption-text">Release Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="release-notes/v1.4-release-notes.html">v1.4 Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="release-notes/v1.3-release-notes.html">v1.3 Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="release-notes/v1.2-release-notes.html">v1.2 Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="release-notes/v1.1-release-notes.html">v1.1 Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="release-notes/v1.0-release-notes.html">v1.0 Release Notes</a></li>
</ul>
<p class="caption"><span class="caption-text">Legacy Docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="infrastructure.html">Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="applications.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="user-documentation.html">User Documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Open OnDemand</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Customization (or the many OOD environment variables)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/OSC/ood-documentation/blob/develop/source/customization.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="customization-or-the-many-ood-environment-variables">
<span id="customization"></span><h1>Customization (or the many OOD environment variables)<a class="headerlink" href="#customization-or-the-many-ood-environment-variables" title="Permalink to this headline">¶</a></h1>
<div class="section" id="setting-the-pun-environment-with-nginx-stage-yml">
<h2>Setting the PUN Environment With <code class="docutils literal notranslate"><span class="pre">nginx_stage.yml</span></code><a class="headerlink" href="#setting-the-pun-environment-with-nginx-stage-yml" title="Permalink to this headline">¶</a></h2>
<p>The configuration file <code class="docutils literal notranslate"><span class="pre">nginx_stage.yml</span></code> is the best way to set the environment which the PUN will use. Defining the mapping <code class="docutils literal notranslate"><span class="pre">pun_custom_env</span></code> allows setting Open OnDemand specific variables and is used for branding, message of the day setting, quota warnings, whitelists and other uses. For environment variables that OOD applications may need, are already in the environment and should be exposed to OOD (<code class="docutils literal notranslate"><span class="pre">$PATH</span></code>, <code class="docutils literal notranslate"><span class="pre">$LD_LIBRARY_PATH</span></code>, etc…) define the sequence <code class="docutils literal notranslate"><span class="pre">pun_custom_env_declarations</span></code>.</p>
<p>An example of both of these uses may be found in <a class="reference external" href="https://github.com/OSC/ondemand/blob/d85a3982d69746144d12bb808d2419b42ccc97a1/nginx_stage/share/nginx_stage_example.yml#L26-L43">nginx_stage_example.yml</a></p>
</div>
<div class="section" id="announcements-and-message-of-the-day-motd">
<h2>Announcements and Message of the Day (MOTD)<a class="headerlink" href="#announcements-and-message-of-the-day-motd" title="Permalink to this headline">¶</a></h2>
<p>Two hooks for customizing the Dashboard are Announcements and MOTD. Announcements get the classes <code class="docutils literal notranslate"><span class="pre">alert</span> <span class="pre">alert-warning</span></code> and appear above the <code class="docutils literal notranslate"><span class="pre">$OOD_DASHBOARD_LOGO</span></code> . Announcement files are expected to be found at: <code class="docutils literal notranslate"><span class="pre">/etc/ood/config/announcement.(md|yml)</span></code> or <code class="docutils literal notranslate"><span class="pre">/etc/ood/config/announcements.d/any_file_name.(md|yml)</span></code>. To display a MOTD file on the Dashboard ensure that the environment variables <code class="docutils literal notranslate"><span class="pre">$MOTD_PATH</span></code> and <code class="docutils literal notranslate"><span class="pre">$MOTD_FORMAT</span></code> are set like so:</p>
<blockquote>
<div><div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nv">MOTD_PATH</span><span class="o">=</span><span class="s2">&quot;/path/to/your/motd&quot;</span> <span class="c1"># this supports both file and RSS feed URIs</span>
<span class="nv">MOTD_FORMAT</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$MOTD_FORMAT_HERE</span><span class="s2">&quot;</span> <span class="c1"># markdown, txt, rss</span>
</pre></div>
</div>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Warnings about the announcement file being missing may be present in users’ nginx logs. Despite the warning the Dashboard will still function normally without those files being present.</p>
</div>
</div>
<div class="section" id="branding">
<h2>Branding<a class="headerlink" href="#branding" title="Permalink to this headline">¶</a></h2>
<p>OOD provides several ways to customize the look of an installation.</p>
<div class="section" id="title">
<h3>Title<a class="headerlink" href="#title" title="Permalink to this headline">¶</a></h3>
<p>The title appears in the navbar and is controlled by the environment variable <code class="docutils literal notranslate"><span class="pre">$OOD_DASHBOARD_TITLE</span></code>.</p>
</div>
<div class="section" id="logos">
<h3>Logos<a class="headerlink" href="#logos" title="Permalink to this headline">¶</a></h3>
<p>The Dashboard logo is controlled by the environment variable <code class="docutils literal notranslate"><span class="pre">$OOD_DASHBOARD_LOGO</span></code>. The favicon is expected to exist at the path <code class="docutils literal notranslate"><span class="pre">$OOD_PUBLIC_URL/favicon.ico</span></code>. For a default OOD installation the favicon will be located at <code class="docutils literal notranslate"><span class="pre">/var/www/ood/public/favicon.ico</span></code>.</p>
</div>
<div class="section" id="colors">
<h3>Colors<a class="headerlink" href="#colors" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nv">OOD_BRAND_BG_COLOR</span><span class="o">=</span><span class="s1">&#39;#c8102e&#39;</span>
<span class="nv">OOD_BRAND_LINK_ACTIVE_BG_COLOR</span><span class="o">=</span><span class="s1">&#39;#990c23&#39;</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="add-shortcuts-to-files-menu">
<h2>Add shortcuts to Files menu<a class="headerlink" href="#add-shortcuts-to-files-menu" title="Permalink to this headline">¶</a></h2>
<p>The Files menu by default has a single link to open the Files app in the user’s
Home Directory. More links can be added to this menu, for Scratch space and
Project space directories.</p>
<p>Adding more links currently requires adding a custom initializer to the
Dashboard app. Ruby code is placed in the initializer to add one or more Ruby
<code class="docutils literal notranslate"><span class="pre">Pathname</span></code> objects to the <code class="docutils literal notranslate"><span class="pre">OodFilesApp.candidate_favorite_paths</span></code> array, a
global attribute that is used in the Dashboard app.</p>
<p>Start by creating the file
<code class="file docutils literal notranslate"><span class="pre">/etc/ood/config/apps/dashboard/initializers/ood.rb</span></code> as such:</p>
<div class="highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="c1"># /etc/ood/config/apps/dashboard/initializers/ood.rb</span>

<span class="no">OodFilesApp</span><span class="o">.</span><span class="n">candidate_favorite_paths</span><span class="o">.</span><span class="n">tap</span> <span class="k">do</span> <span class="o">|</span><span class="n">paths</span><span class="o">|</span>
  <span class="c1"># add project space directories</span>
  <span class="n">projects</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:name</span><span class="p">)</span><span class="o">.</span><span class="n">grep</span><span class="p">(</span><span class="sr">/^P./</span><span class="p">)</span>
  <span class="n">paths</span><span class="o">.</span><span class="n">concat</span> <span class="n">projects</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="nb">p</span><span class="o">|</span> <span class="no">Pathname</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;/fs/project/</span><span class="si">#{</span><span class="nb">p</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="p">}</span>

  <span class="c1"># add scratch space directories</span>
  <span class="n">paths</span> <span class="o">&lt;&lt;</span> <span class="no">Pathname</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;/fs/scratch/</span><span class="si">#{</span><span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
  <span class="n">paths</span><span class="o">.</span><span class="n">concat</span> <span class="n">projects</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="nb">p</span><span class="o">|</span> <span class="no">Pathname</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;/fs/scratch/</span><span class="si">#{</span><span class="nb">p</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<ul class="simple">
<li>The variable <code class="docutils literal notranslate"><span class="pre">paths</span></code> is an array of <code class="docutils literal notranslate"><span class="pre">Pathname</span></code> objects that define a list
of what will appear in the Dashboard menu for Files</li>
<li>At OSC, the pattern for project paths follows
<code class="file docutils literal notranslate"><span class="pre">/fs/project/</span><em><span class="pre">project_name</span></em></code>. So above we:<ol class="arabic">
<li>get an array of all user’s groups by name</li>
<li>filter that array for groups that start with <code class="docutils literal notranslate"><span class="pre">P</span></code> (i.e., <code class="docutils literal notranslate"><span class="pre">PZS0002</span></code>,
<code class="docutils literal notranslate"><span class="pre">PAW0003</span></code>, …)</li>
<li>using <code class="docutils literal notranslate"><span class="pre">map</span></code> we turn this array into an array of <code class="docutils literal notranslate"><span class="pre">Pathname</span></code> objects to
all the possible project directories the user could have.</li>
<li>extend the paths array with this list of paths</li>
</ol>
</li>
<li>For possible scratch space directories, we look for either
<code class="file docutils literal notranslate"><span class="pre">/fs/scratch/</span><em><span class="pre">project_name</span></em></code> or <code class="file docutils literal notranslate"><span class="pre">/fs/scratch/</span><em><span class="pre">user_name</span></em></code></li>
</ul>
<p>On each request, the Dashboard will check for the existence of the directories
in <code class="docutils literal notranslate"><span class="pre">OodFilesApp.candidate_favorite_paths</span></code> array and whichever directories
exist and the user has access to will appear as links in the Files menu under
the Home Directory link.</p>
<div class="figure align-center" id="id1">
<img alt="_images/files_menu_shortcuts_osc.png" src="_images/files_menu_shortcuts_osc.png" />
<p class="caption"><span class="caption-number">Fig. 1 </span><span class="caption-text">Shortcuts to scratch and project space directories in Files menu in OSC OnDemand.</span></p>
</div>
<ul class="simple">
<li>You must restart the Dashboard app to see a configuration change take effect.
This can be forced from the Dashboard itself by selecting
<em>Help</em> → <em>Restart Web Server</em> from the top right menu.</li>
</ul>
<p>If you access the Dashboard, and it crashes, then you may have made a mistake
in <code class="docutils literal notranslate"><span class="pre">ood.rb</span></code> file, whose code is run during the initialization of the Rails
app.</p>
</div>
<div class="section" id="whitelist-directories">
<h2>Whitelist directories<a class="headerlink" href="#whitelist-directories" title="Permalink to this headline">¶</a></h2>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">Should this go in Configure section?</p>
</div>
</div>
<div class="section" id="set-default-ssh-host">
<h2>Set default ssh host<a class="headerlink" href="#set-default-ssh-host" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="custom-job-composer-templates">
<h2>Custom Job Composer Templates<a class="headerlink" href="#custom-job-composer-templates" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="custom-error-page-for-missing-home-directory-on-launch">
<h2>Custom Error Page for Missing Home Directory on Launch<a class="headerlink" href="#custom-error-page-for-missing-home-directory-on-launch" title="Permalink to this headline">¶</a></h2>
<p>Some sites have the home directory auto-create on first ssh login, for example
via pam_mkhomedir.so. This introduces a problem if users first access the system
through OnDemand, which expects the existence of a user’s home directory.</p>
<p>In OnDemand &lt;= 1.3 if the user’s home directory was missing a non-helpful single
string error would display. Now a friendly error page displays. This error page
can be customized by adding a custom one to <code class="docutils literal notranslate"><span class="pre">/etc/ood/config/pun/html/missing_home_directory.html</span></code>.</p>
<p>See <a class="reference external" href="https://discourse.osc.edu/t/launching-ondemand-when-home-directory-does-not-exist/53/">this Discourse discussion</a> for details.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="enable-desktops.html" class="btn btn-neutral float-right" title="Enable Interactive Desktop" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="installation/resource-manager/sge.html" class="btn btn-neutral" title="Configure Grid Engine" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017-2018, Ohio Supercomputer Center.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Documentation Versions</span>
    v: 
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Versions</dt>
      
        <dd><a href="https://OSC.github.io/ood-documentation/master/customization.html">master</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.3/customization.html">1.3</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.2/customization.html">1.2</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.1/customization.html">1.1</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.0/customization.html">1.0</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/develop/customization.html">develop</a></dd>
      
    </dl>
    <dl>
      <dt>On GitHub</dt>
        <dd>
          <a href="http://openondemand.org/">Website</a>
        </dd>
        <dd>
          <a href="https://github.com/OSC/Open-OnDemand">Main Repo</a>
        </dd>
    </dl>
    <hr/>
    Theme provided by <a href="http://www.readthedocs.org">Read the Docs</a>.
  </div>
</div>

  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.3.0',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>